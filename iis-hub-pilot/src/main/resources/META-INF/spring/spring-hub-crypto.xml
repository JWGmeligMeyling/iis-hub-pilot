<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:c="http://www.springframework.org/schema/c"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:task="http://www.springframework.org/schema/task"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
    
    <!--====================================================================================================
    = KEY PURPOSE IDS
    =====================================================================================================-->
    <beans:bean id="keyPurposeId" class="org.bouncycastle.asn1.x509.KeyPurposeId" abstract="true"/>
    
    <!--====================================================================================================
    = EXTENDED KEY USAGES
    =====================================================================================================-->
    <beans:bean id="keyUsageExt" class="org.bouncycastle.asn1.x509.ExtendedKeyUsage" abstract="true"/>
    
    <!--====================================================================================================
    = X500 NAMES
    =====================================================================================================-->
    <beans:bean id="x500Name" class="org.bouncycastle.asn1.x500.X500Name" abstract="true">
        <beans:constructor-arg index="0" type="org.bouncycastle.asn1.x500.X500NameStyle"
            value="#{ T(org.bouncycastle.asn1.x500.style.BCStrictStyle).INSTANCE }"/>
    </beans:bean>
    
    <!--====================================================================================================
    = SECURE RANDOMS
    =====================================================================================================-->
    <beans:bean id="randSec" class="java.security.SecureRandom" abstract="true"/>
    
    <beans:bean id="randSecSha1" parent="randSec" factory-method="getInstance">
        <beans:constructor-arg index="0" type="java.lang.String" value="#{ T(gov.hhs.onc.iishubpilot.crypto.HubSecureRandomAlgorithms).SHA_1_PRNG }"/>
        <beans:constructor-arg index="1" type="java.security.Provider" value="#{ T(gov.hhs.onc.iishubpilot.crypto.HubCryptoProviders).SUN }"/>
    </beans:bean>
    
    <!--====================================================================================================
    = DESCRIPTORS
    =====================================================================================================-->
    <beans:bean id="cryptoDesc" class="gov.hhs.onc.iishubpilot.crypto.HubCryptoDescriptor" abstract="true"/>
    
    <!--====================================================================================================
    = CONFIGS
    =====================================================================================================-->
    <beans:bean id="cryptoConfig" class="gov.hhs.onc.iishubpilot.crypto.HubCryptoConfig" parent="cryptoDesc" abstract="true"/>
    
    <!--====================================================================================================
    = INFOS
    =====================================================================================================-->
    <beans:bean id="cryptoInfo" class="gov.hhs.onc.iishubpilot.crypto.HubCryptoInfo" parent="cryptoDesc" abstract="true"/>
    
    <!--====================================================================================================
    = CONFIGS: KEY PAIR
    =====================================================================================================-->
    <beans:bean id="keyPairConfig" class="gov.hhs.onc.iishubpilot.crypto.HubKeyPairConfig" parent="cryptoConfig" abstract="true"/>
    
    <beans:bean id="keyPairConfigImpl" class="gov.hhs.onc.iishubpilot.crypto.impl.HubKeyPairConfigImpl" parent="keyPairConfig" abstract="true"
        p:algorithmName="#{ T(gov.hhs.onc.iishubpilot.crypto.HubKeyPairAlgorithms).RSA }"
        p:algorithmOid="#{ T(org.bouncycastle.asn1.pkcs.PKCSObjectIdentifiers).rsaEncryption }"/>
    
    <beans:bean id="keyPairConfigHub" parent="keyPairConfigImpl"
        p:size="2048"/>
    
    <!--====================================================================================================
    = INFOS: KEY PAIR
    =====================================================================================================-->
    <beans:bean id="keyPairInfo" class="gov.hhs.onc.iishubpilot.crypto.HubKeyPairInfo" parent="cryptoInfo" abstract="true"/>
    
    <beans:bean id="keyPairInfoImpl" class="gov.hhs.onc.iishubpilot.crypto.impl.HubKeyPairInfoImpl" parent="keyPairInfo" abstract="true"/>
    
    <!--====================================================================================================
    = CONFIGS: CERTIFICATE
    =====================================================================================================-->
    <beans:bean id="certConfig" class="gov.hhs.onc.iishubpilot.crypto.HubCertificateConfig" parent="cryptoConfig" abstract="true"/>
    
    <beans:bean id="certConfigImpl" class="gov.hhs.onc.iishubpilot.crypto.impl.HubCertificateConfigImpl" parent="certConfig" abstract="true"
        p:algorithmName="#{ T(gov.hhs.onc.iishubpilot.crypto.HubCertificateAlgorithms).X509 }"
        p:algorithmOid="#{ T(org.bouncycastle.asn1.pkcs.PKCSObjectIdentifiers).x509Certificate }"/>
    
    <beans:bean id="certConfigHub" parent="certConfigImpl" abstract="true"
        p:signatureAlgorithmName="#{ T(gov.hhs.onc.iishubpilot.crypto.HubSignatureAlgorithms).SHA_512_RSA }">
        <beans:property name="validInterval">
            <beans:bean class="org.apache.commons.lang3.tuple.MutablePair"
                c:left="#{ new java.util.Date() }"
                c:right="#{ T(org.apache.commons.lang3.time.DateUtils).addYears(new java.util.Date(), 1) }"/>
        </beans:property>
    </beans:bean>
    
    <beans:bean id="certConfigHubCa" parent="certConfigHub"
        p:basicConstraints="#{ new org.bouncycastle.asn1.x509.BasicConstraints(true) }"
        p:serialNumber="1">
        <beans:property name="subjectDn">
            <beans:bean parent="x500Name">
                <beans:constructor-arg index="1" type="java.lang.String" value="CN=iis-hub-pilot_ca"/>
            </beans:bean>
        </beans:property>
    </beans:bean>
    
    <beans:bean id="certConfigHubLeaf" parent="certConfigHub" abstract="true"
        p:basicConstraints="#{ new org.bouncycastle.asn1.x509.BasicConstraints(false) }">
        <beans:property name="extendedKeyUsage">
            <beans:bean parent="keyUsageExt">
                <beans:constructor-arg index="0" type="org.bouncycastle.asn1.x509.KeyPurposeId[]">
                    <beans:array>
                        <beans:bean parent="keyPurposeId">
                            <beans:constructor-arg index="0" type="java.lang.String"
                                value="#{ T(org.bouncycastle.asn1.x509.KeyPurposeId).id_kp_clientAuth.id }"/>
                        </beans:bean>
                        <beans:bean parent="keyPurposeId">
                            <beans:constructor-arg index="0" type="java.lang.String"
                                value="#{ T(org.bouncycastle.asn1.x509.KeyPurposeId).id_kp_serverAuth.id }"/>
                        </beans:bean>
                    </beans:array>
                </beans:constructor-arg>
            </beans:bean>
        </beans:property>
    </beans:bean>
    
    <beans:bean id="certConfigHubServer" parent="certConfigHubLeaf"
        p:serialNumber="#{ certConfigHubCa.serialNumber + 1 }">
        <beans:property name="subjectDn">
            <beans:bean parent="x500Name">
                <beans:constructor-arg index="1" type="java.lang.String" value="CN=iis-hub-pilot_server"/>
            </beans:bean>
        </beans:property>
    </beans:bean>
    
    <beans:bean id="certConfigHubClientDev" parent="certConfigHubLeaf"
        p:serialNumber="#{ certConfigHubServer.serialNumber + 1 }">
        <beans:property name="subjectDn">
            <beans:bean parent="x500Name">
                <beans:constructor-arg index="1" type="java.lang.String" value="CN=iis-hub-pilot_client_dev"/>
            </beans:bean>
        </beans:property>
    </beans:bean>
    
    <!--====================================================================================================
    = INFOS: CERTIFICATE
    =====================================================================================================-->
    <beans:bean id="certInfo" class="gov.hhs.onc.iishubpilot.crypto.HubCertificateInfo" parent="cryptoInfo" abstract="true"/>
    
    <beans:bean id="certInfoImpl" class="gov.hhs.onc.iishubpilot.crypto.impl.HubCertificateInfoImpl" parent="certInfo" abstract="true"/>
    
    <!--====================================================================================================
    = GENERATORS
    =====================================================================================================-->
    <beans:bean id="cryptoGen" class="gov.hhs.onc.iishubpilot.crypto.HubCryptoGenerator" abstract="true"/>
    
    <!--====================================================================================================
    = GENERATORS: KEY PAIR
    =====================================================================================================-->
    <beans:bean id="keyPairGen" class="gov.hhs.onc.iishubpilot.crypto.HubKeyPairGenerator" parent="cryptoGen" abstract="true"/>
    
    <beans:bean id="keyPairGenImpl" class="gov.hhs.onc.iishubpilot.crypto.impl.HubKeyPairGeneratorImpl" parent="keyPairGen" abstract="true">
        <beans:constructor-arg name="prov" value="#{ T(gov.hhs.onc.iishubpilot.crypto.HubCryptoProviders).BC }"/>
    </beans:bean>
    
    <beans:bean id="keyPairGenHub" parent="keyPairGenImpl"
        c:rand-ref="randSecSha1"/>
    
    <!--====================================================================================================
    = GENERATORS: CERTIFICATE
    =====================================================================================================-->
    <beans:bean id="certGen" class="gov.hhs.onc.iishubpilot.crypto.HubCertificateGenerator" parent="cryptoGen" abstract="true"/>
    
    <beans:bean id="certGenImpl" class="gov.hhs.onc.iishubpilot.crypto.impl.HubCertificateGeneratorImpl" parent="certGen" abstract="true">
        <beans:constructor-arg name="prov" value="#{ T(gov.hhs.onc.iishubpilot.crypto.HubCryptoProviders).BC }"/>
    </beans:bean>
    
    <beans:bean id="certGenHub" parent="certGenImpl"/>
</beans:beans>