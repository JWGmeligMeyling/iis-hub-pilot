<?xml version="1.0" encoding="UTF-8"?>
<Server port="%{project.test.server.port.control}" shutdown="SHUTDOWN">
    <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener"/>
    <Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener"/>
    
    <GlobalNamingResources>
        <Resource
            auth="Container"
            factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
            name="UserDatabase"
            pathname="conf/tomcat-users.xml"
            type="org.apache.catalina.UserDatabase"/>
    </GlobalNamingResources>
    
    <Service name="Catalina">
        <Connector
            keyAlias="iis-hub-pilot_server"
            keyPass="pass"
            keystoreFile="%{project.build.directory}/surefire-data/ssl/%{project.artifactId}_store_key.p12"
            keystorePass="pass"
            keystoreProvider="SunJSSE"
            keystoreType="PKCS12"
            maxThreads="150"
            port="%{project.test.server.port.https}"
            protocol="org.apache.coyote.http11.Http11NioProtocol"
            scheme="%{project.test.server.scheme}"
            secure="true"
            SSLEnabled="true"
            sslEnabledProtocols="TLSv1.2"
            sslProtocol="TLSv1.2"
            truststoreAlgorithm="PKIX"
            truststoreFile="%{project.build.directory}/surefire-data/ssl/%{project.artifactId}_store_trust.p12"
            truststorePass="pass"
            truststoreProvider="SunJSSE"
            truststoreType="PKCS12"/>
        <!--
        ciphers="${hub.crypto.cipher.suites}"
        clientAuth="want"
        keyAlias="${hub.crypto.mgr.key.store.entry.server.alias}"
        keyPass="${hub.crypto.mgr.key.store.entry.server.pass}"
        keystoreFile="${hub.crypto.mgr.key.store.file}"
        keystorePass="${hub.crypto.mgr.key.store.pass}"
        truststoreAlgorithm="PKIX"
        truststoreFile="${hub.crypto.mgr.trust.store.file}"
        truststorePass="${hub.crypto.mgr.trust.store.pass}"
        truststoreProvider="SunJSSE"
        truststoreType="PKCS12"
        -->
        
        <Engine name="Catalina" defaultHost="%{project.test.server.host.name}">
            <Realm className="org.apache.catalina.realm.LockOutRealm">
                <Realm className="org.apache.catalina.realm.UserDatabaseRealm" resourceName="UserDatabase"/>
            </Realm>
            
            <Host name="%{project.test.server.host.name}" appBase="webapps">
                <Context path="/%{project.artifactId}" docBase="%{project.build.directory}/%{project.artifactId}-test"/>
                <!--<Context path="%{project.test.server.context.path}" docBase="%{project.build.directory}/%{project.artifactId}-test"/>-->
            </Host>
        </Engine>
    </Service>
</Server>